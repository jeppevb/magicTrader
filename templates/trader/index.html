<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head>
		<meta />
		<title>Magic Trade</title>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
		<script src="{{STATIC_URL}}jquery.ddslick.min.js"></script>
		<link href="{{STATIC_URL}}toastr/toastr.css" rel="stylesheet"/>
		<script src="{{STATIC_URL}}toastr/toastr.js"></script>
		<script type="application/javascript">
			$(function() {
				$("#newBinderCardNameInput").autocomplete({
					source : function(request, response) {
						$.ajax({
							url : 'http://magictrader.kyomu.dk/cards/' + request.term,
							dataType : 'json'
						}).success(function(data) {
							response(data);
						});
					},
					response : function(event, ui) {
						if (ui.content.length < 1) {
							//if nothing came back do this
						}
					},
					select: function( event, ui ) {
						$.ajax({
							url : 'http://magictrader.kyomu.dk/card/' + ui.item.value,
							dataType : 'json'
						}).success(function(data){
							setCurrentCard(data);
						});
					}
				});
				$("#addBinderCardButton").click(
					function() {
						var mycardname = $("#newBinderCardNameInput").val();
						$.ajax({
							url : 'http://magictrader.kyomu.dk/gathercard/' + $("#newBinderCardNameInput").val(),
							dataType : 'json',
							statusCode : {
								404 : function() {toastr.error("Unable to find/add " + mycardname);} 
							}
						}).success(function(data){
							toastr.success("Added " + data + " to database");
							$("#newBinderCardNameInput" ).autocomplete("search");
						});
					}
				);
			});
			function setCurrentCard(carddata){
				$('#newBinderCardName').text(carddata['name']);
				$('#newBinderCardSet').empty();
				var size = 0;
				for(k in carddata['sets']){
					if (carddata['sets'].hasOwnProperty(k)) size++;
					if (size > 1)
						break; 
				}
				if (size == 1){
					for(k in carddata['sets']){
						$('#newBinderCardSet').append('<div class="dd-select" style="width: 200px; background-color: rgb(238, 238, 238); background-position: initial initial; background-repeat: initial initial;"><span class="dd-selected"><img class="dd-selected-image" src="{{MEDIA_URL}}sets/' + carddata['sets'][k]['short'] + '.jpg"><label class="dd-selected-text" style="line-height: 40px;">' + k + '</label></span></div>');
					}
				}else{	
					$('#newBinderCardSet').append('<select id="newBinderCardSetDropdown"></select>')
					for(k in carddata['sets']){
						$('#newBinderCardSetDropdown').append('<option value="' + k + '" data-imagesrc="{{MEDIA_URL}}sets/' + carddata['sets'][k]['short'] + '.jpg">' + k + '</option>');
					};
					$('#newBinderCardSetDropdown').ddslick({height: 500, width: 200});
				}
			}
			
		</script>
	</head>
	<body>
		<div>
			<h2>Trade Binder:</h2>
					<div class="ui-widget"><input id="newBinderCardNameInput" /></div>
					<div><a href="#" id="addBinderCardButton">Find this card on gather so i can trade it</a></div>
					<div id="newBinderCardImage"></div>
					<div id="newBinderCardSet"></div>
					<div id="newBinderCardName"></div>
					<div id="newBinderCardAmount"></div>
					<div id="newBinderCardFoil"></div>
					<div><a onclick="addBinderCard()" href="#">Add card to trade binder</a></div>
		</div>
		<hr />
		<div>
			<h2>Communities:</h2>
			<ul>
				<li></li>
			</ul>
			<a href="#">Join community</a>
		</div>
		<script type="application/javascript">
			//$("#addBinderCardButton").hide(0);
		</script>
	</body>
</html>